# Бэкенд-часть SPA веб-приложения "Трекер полезных привычек"

## Docker

- Собрать командой docker-compose build
- Запустить командой docker-compose up
- Запуск контейнера в фоновом режиме: docker-compose up -d --build

### Установка:

- Убедитесь, что у вас установлен python 3.11 или более новая версия
- Убедитесь, что у вас установлен Postgresql и запущен локальный сервер базы данных
- Убедитесь, что у вас установлен Redis и запущен redis-сервер
- Склонировать репозиторий
- Создать и активировать виртуальное окружение```python -m venv ваша_папка_для_виртуального_окружения```
- Установить зависимости командой ```pip install -r requirements.txt```
- Создать вашу базу данных для работы с проектом ```CREATE DATABASE ваша_база_данных;```
- Создать миграции через ```python manage.py makemigrations``` и применить их ```python manage.py migrate```
- Открыть командную строку и запустить ```python manage.py runserver```
- Для запуска Celery открыть другой экземпляр командной строки и запустить ```celery -A config worker -l INFO -P eventlet```<br>
- Для запуска django-celery-beat открыть другой экземпляр командной строки и
  запустить ```celery -A config beat --loglevel=info```<br>
- Создать бота в телеграм
- В файле .env.sample заполнить данные для работы с проектом и переименовать его в .env
- Кастомная команда для создания суперпользователя ```python manage.py csu```<br>

### Используемые технологии:

- DjangoRestFramework<br>
- Docs/ReDoc ```host://docs/``` ```host://redoc/```, работает авторизация по Bearer токену<br>
- Redis<br>
- Celery<br>
- CORS<br>
- Сервис рассылок сообщений через Telegram<br>
- Пагинация для вывода списка привычек

### Логика работы системы:

- Зарегистрировать пользователя (POST запрос) ```/users/create/```, ОБЯЗАТЕЛЬНО указать chat_id
- Получить токен пользователя (POST запрос) ```/users/token/```
- Создать привычку, при этом если это полезная ```is_nice=False``` привычка, то необходимо указать также
  вознаграждение ```reward```, либо связанную приятную ```is_nice=True``` привычку ```associated_hab```, а также
  время выполнения привычки и длительность выполнение этой привычки
- При этом стоит валидация, по следующим условиям:
  - Нельзя одновременно выбирать связанную привычку и вознаграждение
  - Время выполнения привычки не должно быть больше 120 секунд
  - В связанные привычки могут попадать только привычки с признаком приятной привычки
  - У приятной привычки не может быть вознаграждения или связанной привычки
  - Нельзя выполнять привычку реже, чем 1 раз в 7 дней
- Если в привычке указать ```is_public=True```, то она будет доступна в списке всех публичных привычек для других
  пользователей
- После создания привычек отрабатывает функция, которая проверяет время и если время совпадает с текущим -
  отправляет уведомление в Telegram для пользователя

### Права доступа:

- Каждый пользователь имеет доступ только к своим привычкам по механизму CRUD.
- Пользователь может видеть список публичных привычек без возможности их как-то редактировать или удалять.

### Эндпоинты:
- Регистрация пользователя
- Просмотр деталей профиля
- Редактирование профиля
- Получение токена
- Обновление токена
- Список публичных привычек
- Список своих привычек с пагинацией
- Создание привычки
- Редактирование привычки(через PUT)
- Удаление привычки